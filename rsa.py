import random
from fractions import gcd

def recover_primes(n, e, d):
    """Recovers primes
    Input:
    n -- modulus
    e -- public exponent
    d -- private exponent
    Output:
    (p,q) -- primes, n = p*q

    Modulus n is product of two primes p and q
    e and d satisfy de = 1 mod lcm(p-1, q-1)
    """
    k = e * d - 1
    if k & 1:
        # k is odd
        raise Exception("Prime factors not found")

    # k = 2^t * r
    r = k
    t = 0
    while not r & 1:  # while r is even
        r = r // 2
        t += 1

    for i in range(100):
        loop_i_flag = 0
        g = random.randint(0, n-1)
        y = pow(g, r, n)
        if y == 1 or y == n-1:
            continue

        for j in range(1, t):
            x = pow(y, 2, n)
            if x == 1: 
                break
            if x == n-1:
                loop_i_flag = 1
                break
            y = x

        if loop_i_flag:
            continue

        x = pow(y, 2, n)
        if x == 1:
            p = gcd(y-1, n)
            q = n // p
            return p, q

e = 65537
d = 2605327007025229672619823608290529477901570186817476483245111840081388429258137292050320567902413927906398093474093638289240848573845949236270520357715175943866081817117761574354311725847730092676137719583207850957610489933927881150119390013384204899204355501985426396051289860285185495176360530552262991422380733125879568788200181099077872475876316869573790226160604482471938347872049334158397635530605890754106737611264034976582661877166728256865134233870348509072453075373897004474133190964577830278685022624970579260652112272558060066281656149658625951366733858389574948940918341761737044661364049424861520801913
n = 29092744259569343509028008147305576826245562333184010271329850854219450245065691550366648331678395228011860939173909485868457572496872035286669124669207613875132288984230148287350234720886469089063901470152443845324402569228119193548368455155420111855368179678585600565345609741610189435572182670097744022635980345536778349059514613572452551748127507681273011125863639880236639082655674265552984969216003972780327527480190458627035945631693592016512234038123298334679200930630855050945537070067998588151047446387291697676570656864801690758012165940421164510968780382786167832834626120986925037156965920074807097462563
